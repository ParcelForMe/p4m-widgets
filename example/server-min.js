function allowCrossDomain(e,s,t){s.header("Access-Control-Allow-Origin","*"),s.header("Access-Control-Allow-Methods","GET,PUT,POST,DELETE,OPTIONS,PATCH,FILE"),s.header("Access-Control-Allow-Headers","Origin, Content-Type, X-Auth-Token"),t()}function addJsonHeaders(e,s,t){s.header("Content-Type","application/json"),t()}function simulateDelay(e,s,t){console.log("Waiting for 1 second.."),setTimeout(t,1e3)}function logRoute(e,s,t){var o=" "+e.get("host")+e.originalUrl;console.log(o),t()}var Express=require("express"),Http=require("http"),BodyParser=require("body-parser"),p4mEndpoint=require("./p4m_endpoints.js"),SITE_PORT=process.env.port||8080,site=Express();site.use(BodyParser.json()),site.use(allowCrossDomain),site.set("port",SITE_PORT),site.use(logRoute),site.use("/p4m/getP4MAccessToken",p4mEndpoint.getP4MAccessToken),site.post("/p4m/localLogin",p4mEndpoint.localLogin),site.use("/p4m/renewShippingToken",p4mEndpoint.renewShippingToken),site.use("/p4m/checkout",p4mEndpoint.checkout),site.post("/p4m/updShippingService",p4mEndpoint.updShippingService),site.post("/p4m/itemQtyChanged",p4mEndpoint.itemQtyChanged),site.post("/p4m/applyDiscountCode",simulateDelay,p4mEndpoint.applyDiscountCode),site.use("/p4m",addJsonHeaders),site.use("/p4m",Express.static("static_api/p4m")),site.use("/lib/p4m-widgets",Express.static("..")),site.use("/lib",Express.static("../bower_components")),site.use("/build",Express.static("../build")),site.use(Express.static(".")),Http.createServer(site).listen(SITE_PORT),console.log("Server listening on",SITE_PORT),process.on("uncaughtException",function(e){console.log("Unhandled exception:",e.stack)});
<script src="../../webcomponentsjs/webcomponents.min.js"></script>
<link rel="import" href="../../polymer/polymer.html" />
<link rel="import" href="../../iron-icons/iron-icons.html" />
<link rel="import" href="../../iron-icons/maps-icons.html" />

<dom-module id="gfs-location-button">

    <template>
        <style> 
        </style>

        <div>
            <iron-ajax id="ajaxGetLocation"
                       method="GET"
                       handle-as="json"
                       on-response="_handleGetLocationResponse"
                       on-error="_handleError"
                       timeout="10000"
                       debounce-duration="300">
            </iron-ajax>
            
            <div class="gfs-button gfs-mini-button"><iron-icon icon="maps:place"></iron-icon>{{addressName}}</div>
        </div>

    </template>

    <script>

        Polymer({
            is: "gfs-location-button",

            properties: {
                addressName: {
                    type: String,
                    value: ""
                },
                addressData: {
                    type: Object,
                    value: {}
                },
                googleApiKey: {
                    type: String
                },
                geoLocation: {
                    type: Object
                }
            },

            ready: function () {
                //Now call Google geocoder to get lat and lng
                this._geocodeAddress = this.addressData.addressLineCollection[0] + "," + this.addressData.Postcode;
                this.$.ajaxGetLocation.url = "https://maps.googleapis.com/maps/api/geocode/json?address=" + this._geocodeAddress + "&key=AIzaSyAMQhcXM06TZBHZ95LwJBRVGSV4CqUQMpI"; //Make this a parameter
                this.$.ajaxGetLocation.generateRequest();
            },

            _handleGetLocationResponse: function (e) {
                //console.log(e.detail.response);
                var results = e.detail.response.results;
                if (results && results.length) {
                    this.geoLocation = results[0].geometry.location;
                }
                else {
                    console.error("Failed to geocode", this._geocodeAddress);
                }
            },

            _handleError: function(err) {
            console.error(err);
        }




		});
    </script>
</dom-module>

<script src="../../webcomponentsjs/webcomponents.min.js"></script>
<link rel="import" href="../../polymer/polymer.html" />
<link rel="import" href="../../iron-icons/iron-icons.html" />
<link rel="import" href="../../iron-icons/maps-icons.html" />

<dom-module id="gfs-location-button">

    <template>
        <style> 
        </style>

        <div class="wrap">
            <iron-ajax id="ajaxGetLocation"
                       method="GET"
                       handle-as="json"
                       on-response="_handleGetLocationResponse"
                       on-error="_handleError"
                       timeout="10000"
                       debounce-duration="300">
            </iron-ajax>
            
            <div class="content">
            <div class="addressTitle"><i class="p4micon p4micon-map-marker"></i>{{addressData.providerName}}</div>
            <!-- <p>{{addressData.Street1}}<br />
            {{addressData.City}} {{addressData.State}}</p> -->
            <p>212 Strand<br />
            London, WC2R 1AP</p>
            </div>
        </div>

    </template>

    <script>

        Polymer({
            is: "gfs-location-button",

            properties: {
                addressData: {
                    type: Object,
                    value: {}
                },
                googleApiKey: {
                    type: String
                },
                geoLocation: {
                    type: Object
                }
            },

            ready: function () {
                var addressStr = this.addressData.geoLocation.addressLines[0] + "," + this.addressData.geoLocation.postCode;
                this.$.ajaxGetLocation.url = "https://maps.googleapis.com/maps/api/geocode/json?address=" + addressStr + "&key=AIzaSyAMQhcXM06TZBHZ95LwJBRVGSV4CqUQMpI"; //Make this a parameter
                this.$.ajaxGetLocation.generateRequest();
            },

            _handleGetLocationResponse: function (e) {
                console.log(e.detail.response);
                var results = e.detail.response.results;
                if (results && results.length) {
                    this.geoLocation = results[0].geometry.location;
                }
            },

            _handleError: function(err) {
            console.error(err);
        }




		});
    </script>
</dom-module>

<link rel="import" href="../../polymer/polymer.html" />
<link rel="import" href="../../iron-overlay-behavior/iron-overlay-behavior.html" />
<link rel="import" href="../../polymer-cookie/polymer-cookie.html" />

<dom-module id="p4m-general-fault">

    <template>
        <content id="p4m-general-fault-content" class="p4m-general-fault">
            <div class="checking">

            <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
                     viewBox="0 0 456.2 91" style="enable-background:new 0 0 456.2 91;" xml:space="preserve" id="logo">
                <style type="text/css">
                    .st0{display:none;}
                    .st1{display:inline;}
                    .st2{fill:#37A553;}
                </style>
                <g id="Layer_2" class="st0">
                    <rect x="0.6" class="st1" width="480" height="91"/>
                </g>
                <g id="Layer_1">
                    <g id="Vector_Smart_Object_xA0_Image_1_">
                    </g>
                    <g id="Parcel_For_Me">
                    </g>
                    <g>
                        <path class="st2" d="M157.8,32.8c0-0.2-0.4-0.4-0.6-0.4h-0.4c-0.2,0-0.4,0.2-0.6,0.4l-11.7,25.6c-0.2,0.4,0.2,1,0.9,0.8h2.4
                            c0.4,0,0.5-0.4,0.8-0.6c0.6-1.6,1.5-3.3,2.3-5.1h12.5l2.3,5.3c0,0.4,0.4,0.6,0.8,0.6h2.5c0.6,0,0.9-0.6,0.6-1L157.8,32.8z
                             M152.2,50.2l4.7-10.4h0.2l4.7,10.4H152.2z"/>
                        <path class="st2" d="M95.7,5.7c-4.1,1-12.2,4.5-19.8,1.3c-11.1-4.3-15.3,8-16.2,11.5C58.9,21.7,51.1,46,8.6,4.1
                            C7.4,2.8,5.6,3.7,5.8,5.4c0.5,14.4,13.6,28.3,13.6,28.3S49.9,67.5,6,75.3c-9,2-4.1,4.5-2,5.3c0.8,0.2,1.4,0.8,2,1.4
                            c0.8,0.8,1.3,2,0,3.5c-2.4,2.4-5.7,6.4,3.7,5.1c9.4-1.4,69.6-8.8,71.9-51.7C82.7,14.5,92,11.4,96.5,7.1
                            C97.1,6.5,96.5,5.4,95.7,5.7z M73.7,10.8c1,0,1.6,0.2,2.3,0.2c0.2,0.2,0.5,0.5,0.2,0.8l-1.3,1.7c0,0-3.5,4.1-5.5,1.8
                            c-0.2-0.2-0.2-0.4-0.4-0.6C67.8,11.8,71.9,10.4,73.7,10.8z M14.5,87.6c-0.2,0-0.4-0.2-0.6-0.2c-0.6-1.6-1.4-6.7,8.2-11.2
                            C49,66,56.8,45.7,59.5,38c3.3-9,7.4-15.8,13.5-10.2C89.7,43.1,69.3,79.4,14.5,87.6z"/>
                        <path class="st2" d="M132.4,32.6h-8.5c-0.5,0-0.8,0.4-0.8,0.8v25.2c0,0.4,0.4,0.8,0.8,0.8h2.3c0.4,0,0.8-0.4,0.8-0.8v-9h5.5
                            c4.6,0,8.5-3.8,8.5-8.5C140.9,36.6,137.1,32.6,132.4,32.6z M132.2,45.9h-5.3v-9.4h5.3c2.7,0,4.9,1.8,4.9,4.5
                            C137.2,43.9,134.9,45.9,132.2,45.9z"/>
                        <path class="st2" d="M70.7,13.8c1,1.3,2.8-1,2.8-1l0.6-0.4c0.2-0.2,0-0.4-0.2-0.4s-0.6,0-1-0.2c-1-0.2-3.1,0.6-2.4,1.8
                            C70.5,13.8,70.7,13.8,70.7,13.8z"/>
                        <path class="st2" d="M40.1,22.6c0,0.6,0.4,0.9,0.8,1c2.3,0.8,10.4,3.5,13.1-1.6c0.6-1,0.2-2.3-0.6-3.1c-6.1-4.9-9-9.4-11.8-14.3
                            V4.4c-2.4-5.1-7.4-7.1-6.4,3.5C35.8,16.4,39.1,21.1,40.1,22.6z"/>
                        <path class="st2" d="M377.4,40.8c0-4.5-3.9-8.2-8.4-8.2h-10.4c-0.5,0-0.8,0.4-0.8,0.8l-0.2-0.1v24.9c0,0.4,0.4,0.8,0.8,0.8h2.4
                            c0.4,0,0.8-0.4,0.8-0.8v-9.6h5.7l5.1,10c0,0.2,0.4,0.4,0.6,0.4h3.1c0.6,0,0.9-0.6,0.6-1l-5.1-9.6
                            C375.1,47.2,377.4,44.3,377.4,40.8z M368.5,45.7h-6.7v-9.2h6.7c2.4,0,4.7,2,4.7,4.5C373.2,43.7,370.9,45.7,368.5,45.7z"/>
                        <path class="st2" d="M313.6,32.6h-15.1c-0.5,0-0.8,0.4-0.8,0.8l-0.2-0.1v25.3c0,0.4,0.4,0.8,0.8,0.8h2.4c0.4,0,0.8-0.4,0.8-0.8
                            v-10h10.2c0.4,0,0.8-0.4,0.8-0.8v-2c0-0.4-0.4-0.8-0.8-0.8h-10.2v-8.8h12.1c0.5,0,0.8-0.4,0.8-0.8v-2
                            C314.4,33,314,32.6,313.6,32.6z"/>
                        <path class="st2" d="M196.8,40.8c0-4.5-3.9-8.2-8.4-8.2H178c-0.5,0-0.8,0.4-0.8,0.8l-0.2-0.1v24.9c0,0.4,0.4,0.8,0.8,0.8h2.4
                            c0.4,0,0.8-0.4,0.8-0.8v-9.6h6l5.1,10c0,0.2,0.4,0.4,0.6,0.4h3.1c0.6,0,0.9-0.6,0.6-1l-5.3-9.6C194.5,47.2,196.8,44.3,196.8,40.8z
                             M188,45.7h-7v-9.2h7c2.4,0,4.7,2,4.7,4.5C192.7,43.7,190.4,45.7,188,45.7z"/>
                        <path class="st2" d="M334.7,32.4c-7.6,0-13.7,6.1-13.7,13.7s6.1,13.7,13.7,13.7c7.6,0,13.7-6.2,13.7-13.7
                            C348.5,38.5,342.3,32.4,334.7,32.4z M334.7,55.9c-5.3,0-9.8-4.5-9.8-9.8c0-5.6,4.5-10,9.8-10c5.3,0,9.8,4.7,9.8,10
                            S340.2,55.9,334.7,55.9z"/>
                        <path class="st2" d="M451.8,36.3c0.5,0,0.8-0.4,0.8-0.8v-2c0-0.4-0.4-0.8-0.8-0.8h-15.2c-0.5,0-0.8,0.4-0.8,0.8h0.1v25.2
                            c0,0.4,0.4,0.8,0.8,0.8h15.1c0.5,0,0.8-0.4,0.8-0.8v-2c0-0.4-0.4-0.8-0.8-0.8h-12.1v-8.2h10.2c0.4,0,0.8-0.4,0.8-0.8v-2
                            c0-0.4-0.4-0.8-0.8-0.8h-10.2v-7.8H451.8z"/>
                        <path class="st2" d="M252.5,32.6h-15.1c-0.5,0-0.8,0.4-0.8,0.8v25.2c0,0.4,0.4,0.8,0.8,0.8h15.1c0.5,0,0.8-0.4,0.8-0.8v-2
                            c0-0.4-0.4-0.8-0.8-0.8h-12.1v-8.2h10.2c0.4,0,0.8-0.4,0.8-0.8v-2c0-0.4-0.4-0.8-0.8-0.8h-10.2v-7.8h12.1c0.5,0,0.8-0.4,0.8-0.8
                            v-2C253.3,33,252.9,32.6,252.5,32.6z"/>
                        <path class="st2" d="M277,55.7h-10.2V33.4c0-0.4-0.4-0.8-0.8-0.8h-2.4c-0.5,0-0.8,0.4-0.8,0.8v25.1c0,0.4,0.4,0.8,0.8,0.8H277
                            c0.5,0,0.8-0.4,0.8-0.8v-2C277.8,56.1,277.4,55.7,277,55.7z"/>
                        <path class="st2" d="M218,36.1c2.2,0,4.7,0.8,6.5,2.4c0.4,0.4,0.8,0.4,1,0l1.6-1.6c0.4-0.2,0.4-0.8,0-1c-2.7-2.2-5.3-3.5-9.2-3.5
                            c-7.5,0-13.7,6.1-13.8,13.5c0,7.6,6.2,13.7,13.7,13.7c3.2,0,6.5-1.3,9.2-3.7c0.2-0.2,0.2-0.8,0-1l-1.8-1.6c-0.2-0.2-0.4-0.2-0.8,0
                            c-1.8,1.4-3.7,2.4-6.5,2.4c-5.5,0-9.6-4.5-9.6-9.8C208.5,40.6,212.5,36.1,218,36.1z"/>
                        <path class="st2" d="M421.9,32.8c0-0.4-0.4-0.6-0.6-0.6h-0.6c-0.2,0-0.6,0.2-0.6,0.4l-8,19.5h-0.2l-8-19.5c0-0.2-0.4-0.4-0.6-0.4
                            h-0.6c-0.2,0-0.6,0.4-0.6,0.6l-4.8,25.6c0,0.4,0.2,0.8,0.8,0.8h2.4c0.2,0,0.6-0.4,0.6-0.6l2.7-16.9h0.2l7,17.6
                            c0,0.2,0.4,0.4,0.6,0.4h0.6c0.4,0,0.6-0.2,0.6-0.4l7-17.6h0.2l2.8,16.9c0.2,0.4,0.4,0.6,0.8,0.6h2.4c0.4,0,0.9-0.2,0.6-0.8
                            L421.9,32.8z"/>
                    </g>
                </g>
                </svg>
                <template is="dom-if" if="{{loginBlocked}}">
                    <h1>You're not logged in</h1>
                    <p>Please login again</p>
                    <div class="layout horizontal center buttons">
                        <button class="p4m-button inverse auto" on-click="requestLogin"><i class="p4micon-refresh"></i>Login again</button>
                        <template is="dom-if" if="shared-mode">
                            <span>Or,</span>
                            <a on-click="basicCheckout">Use basic checkout</a>
                        </template>
                    </div>
                </template>
                <template is="dom-if" if="{{!loginBlocked}}">
                    <h1>Hmm... Looks like something went wrong</h1>
                    <p>We're having trouble connecting to {{service}}</p>
                    <div class="layout horizontal center buttons">
                        <button class="p4m-button inverse auto" on-click="tryAgain"><i class="p4micon-refresh"></i>Try again</button>
                        <template is="dom-if" if="shared-mode">
                            <span>Or,</span>
                            <a on-click="basicCheckout">Use basic checkout</a>
                        </template>
                    </div>
                    <div class="layout horizontal center buttons" style="margin-top:2.4em;">
                        <span>Still having trouble?</span> <a on-click="logOut">Try logging into Parcel For Me again</a>
                    </div>
                </template>
            </div>
        </content> 

        <polymer-cookie id="p4mToken" name="p4mToken"></polymer-cookie>
        <polymer-cookie id="gfsCheckoutToken" name="gfsCheckoutToken"></polymer-cookie>
     </template>

    <style>
        :host {
            --iron-overlay-backdrop-background-color: #fff;
            --iron-overlay-backdrop-opacity: 0.95;
            position: fixed;
            top: 0;
            left: 0;
            min-width: 100%;
            min-height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        svg#logo {
            width: 240px;
        }
        iron-overlay-backdrop.opened {
            opacity: 0.95;
            background-color: #fff;
        }
        iron-overlay-backdrop {
            --iron-overlay-backdrop-background-color: #fff;
            --iron-overlay-backdrop-opacity: 0.95;
        }
        paper-spinner {
            width: 200px;
            height: 200px;
        }
        img.p4m-register-logo {
            width: 300px;
            max-width: 90%;
        }
/*      h1 {
            color: #fff;
            font-size: 30px;
            line-height: 1em;
            margin-bottom: .425em;
        }*/

        /* OMG THIS WORKS!!!! */
        h1 {
/*          border: var(--p4m-general-fault-border,5px solid green);*/
            color: var(--p4m-general-fault-h1-border,#37a553);
            font-size: var(--p4m-general-fault-h1-font-size,30px);
            line-height: var(--p4m-general-fault-h1-line-height,1em);
            margin-bottom: var(--p4m-general-fault-h1-margin-bottom,.425em);
            letter-spacing: -.014em;
        }

        /* Trying to style this thing */
/*        iron-overlay-backdrop {
            background-color: pink;
        }
*/

        /* END Trying to style this thing */


        h1 span {
            line-height: 1.5em;
        }
        p {
            color: #37a553;
            font-size: 21px;
            font-weight: 200;
            line-height: 1.3em;
        }
        i.p4micon-refresh {        
            font-weight: normal;
            font-size: 18px;
            margin-right: 8px;
            -webkit-font-smoothing: subpixel-antialiased;
        }
        .buttons button {
            margin-left: 0;
        }
        .buttons {
            margin: .6em 0;
            flex-direction: row;
            display: flex;
        }
        .buttons a {
            color: #37a553;
            padding: 4px 0;
            text-decoration: none;
            border-bottom: 2px solid rgba(55, 165, 83, 0);
            margin: 10px 10px 4px 0;
        }
        .buttons a:hover {
            color: #37a553;
            border-bottom: 2px solid rgba(55, 165, 83, 0.65);
        }
        .buttons span {
            color: rgba(55, 165, 83, 0.65);
            padding: 4px 0 6px 0;
            /*margin: 0 10px 0 0;*/
            margin: 10px 10px 4px 0;
        }
        .checking {
            width: 540px;
            max-width: 100%;
        }
        #generalFault {
            width: 320px;
            margin: auto;
            display: flex;
            flex-direction: column;
        }
        #p4mPurchaseContainer .card-panel.no-card {
            flex-direction: column;
        }
        #p4mPurchaseContainer .card-panel.no-card p {
            margin: 0;
        }
        #p4mPurchaseContainer .card-panel p {
            text-align: center;
            line-height: 1.5em;
            font-size: 14px;
            display: block;
            font-size: 14px;
        }
        #p4mPurchaseContainer .card-panel p a {
            border-bottom: 2px solid transparent;
            display: block;
        }
        #p4mPurchaseContainer .card-panel p a:hover {
            color: #37a553;
            border-bottom: 2px solid #37a553;
        }
        #p4m-logo {
            width: 24px;
            height: 24px;
        }
        #p4m-logo svg {
            fill: #37a553;
        }
        .generalFault h3 {
            color: #37a553;
            font-weight: 200 !important;
            font-size: 18px;
            height: 24px;
            padding: 0;
            margin-bottom: 12px;
            display: flex;
            align-items: flex-end;
            font-weight: 200 !important;
        }
        .generalFault p4m-spinner {
            background: rgba(55, 165, 83, 0.3);
            position: relative;
            top: initial;
            bottom: initial;
            margin-bottom: 12px;
        }
        button {
          color: #37a553;
          border-radius: 24px;
          text-align: center;
          cursor: pointer;
          height: 42px;
          width: 100%;
          -webkit-transition: all 0.15s ease-in-out 0s;
          -khtml-transition: all 0.15s ease-in-out 0s;
          -moz-transition: all 0.15s ease-in-out 0s;
          -ms-transition: all 0.15s ease-in-out 0s;
          -o-transition: all 0.15s ease-in-out 0s;
          transition: all 0.15s ease-in-out 0s;
          background-color: rgba(255,255,255,0);
          box-shadow: inset 0 0 2000px #fff;
          border: solid 2px rgba(255, 255, 255, 0.5); 
          align-self: center !important;
          font-weight: 400 !important;
          font-size: 18px !important;
          padding: 0 16px !important;
          display: flex !important;
          line-height: normal !important;
          letter-spacing: normal !important;
          justify-content: center;
          align-items: center;
        }
        button:hover {
          background-color: #fff;
        }
        button:focus, .button:focus, a:focus {
            outline: none;
        }
        button.auto {
          width: auto !important;
          align-self: center !important;
          justify-content: center;
        }
        button.inverse {
            color: #37a553 !important;
            background-color: transparent !important;
            box-shadow: none !important;
            border: solid 2px rgba(55, 165, 83, 0.5) !important;
        }
        button.inverse:hover {
            color: #fff !important;
            background-color: #37a553 !important;
            box-shadow: none !important;
            border: solid 2px rgba(255,255,255,.5) !important;
        }
        button.secondary {
            color: #fff;
            background-color: transparent;
            box-shadow: none;
            border: solid 2px rgba(55, 165, 83, 0.5);
        }
        button.secondary:hover {
            color: #37a553;
            background-color: rgba(55, 165, 83, 0.05);;
            box-shadow: inset 0 0 1000px #fff, inset 0 0 1000px #fff;
            border: solid 2px rgba(255, 255, 255, 0.5);
        }

        /*iron-overlay-backdrop {
            background-color: #37a553;
        }*/

    </style>

    <script>

        Polymer({
            is: "p4m-general-fault",
            behaviors: [Polymer.IronOverlayBehavior],
            properties: {
                sharedMode: {
                    type: Object,
                    value: false
                },
                service: String,
                loginBlocked: {
                    type: Object,
                    value: false
                },
                basicCheckoutUrl: {
                    type: String,
                    value: "/"
                }
            },
            listeners: {
                "iron-overlay-opened": "onOpen"
            },

            ready: function()
            {
                this.backdropElement.classList.add('p4m-general-fault');
            },

            onOpen: function(e) {
            },

            show: function(serviceDesc) {
                this.service = serviceDesc;
                this.open();
            },

            tryAgain: function() {
                window.location.reload();
            },

            basicCheckout: function() {
                window.location.href =  this.basicCheckoutUrl;
            },

            requestLogin: function () {
                var event = new CustomEvent('p4m-request-login');
                window.dispatchEvent(event);
            },

            logOut: function() {
                this.$.p4mToken.eraseCookie();
                this.$.gfsCheckoutToken.eraseCookie();
                var loginWidget = document.getElementsByTagName("p4m-login")[0];
                loginWidget.clearCookies();
                window.location.href = "/";
            },

            deleteCookie: function(name) {
                document.cookie = name + '=;expires=Thu, 01 Jan 1970 00:00:01 GMT;';
            }
        });
    </script>
</dom-module>
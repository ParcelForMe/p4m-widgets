<link rel="import" href="../../polymer/polymer.html" />
<link rel="import" href="../p4m-api/p4m-api.html" />
<link rel="stylesheet" href="../p4m-shared/p4m.css" />

<dom-module id="p4m-register">
    <template>
        <polymer-cookie id="p4mTokenCookie" name="p4mToken"></polymer-cookie>
        <polymer-cookie id="p4mGivenNameCookie" name="p4mGivenName"></polymer-cookie>
        <template is="dom-if" if="{{_notLoggedIn}}">
            <div id="p4mRegisterContainer" class$="{{_topClass}}">

                <div>
                    <div class="p4m-register-middle">
                        <div class="p4m-register-explain">
                            <div id="p4m-profile-container" class$="{{_topClass}}">
                                <polymer-cookie id="p4mTokenCookie" name="p4mToken"></polymer-cookie>
                                <polymer-cookie id="p4mAvatarCookie" name="p4mAvatarUrl"></polymer-cookie>
                                <polymer-cookie id="p4mGivenNameCookie" name="p4mGivenName"></polymer-cookie>
                                <paper-spinner id="spinner"></paper-spinner>         
                            </div>
                            <div id="p4m-logo">
                                <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
                                     viewBox="0 0 146 78" style="enable-background:new 0 0 146 78;" xml:space="preserve">
                                <g>
                                    <path class="st0" d="M98.9,4c-2.3,0.6-6.8,2.5-11,0.7c-6.1-2.4-8.4,4.4-8.9,6.3c-0.4,1.8-4.7,15.2-28.2-7.9
                                        c-0.7-0.7-1.7-0.2-1.6,0.7c0.3,8,7.5,15.6,7.5,15.6s16.8,18.7-7.4,23c-5,1.1-2.3,2.5-1.1,2.9c0.4,0.1,0.8,0.4,1.1,0.8
                                        c0.4,0.4,0.7,1.1,0,1.9c-1.3,1.3-3.2,3.5,2,2.8c5.2-0.8,38.5-4.8,39.7-28.5c0.6-13.5,5.8-15.2,8.2-17.6C99.7,4.4,99.4,3.9,98.9,4z
                                         M86.8,6.8c0.6,0,0.9,0.1,1.3,0.1c0.1,0.1,0.3,0.3,0.1,0.4l-0.7,1c0,0-1.9,2.3-3,1c-0.1-0.1-0.1-0.2-0.2-0.3
                                        C83.5,7.4,85.8,6.6,86.8,6.8z M54.1,49.2c-0.1,0-0.2-0.1-0.3-0.1c-0.3-0.9-0.8-3.7,4.5-6.2c14.9-5.6,19.2-16.8,20.7-21.1
                                        c1.8-5,4.1-8.7,7.4-5.6C95.6,24.6,84.3,44.7,54.1,49.2z"/>
                                    <path class="st0" d="M85.2,8.5c0.6,0.7,1.6-0.6,1.6-0.6l0.3-0.2c0.1-0.1,0-0.2-0.1-0.2c-0.1,0-0.3,0-0.6-0.1
                                        c-0.6-0.1-1.7,0.3-1.3,1C85,8.5,85.2,8.5,85.2,8.5z"/>
                                    <path class="st0" d="M68.2,13.3c0,0.3,0.2,0.5,0.4,0.6c1.3,0.4,5.8,1.9,7.2-0.9c0.3-0.6,0.1-1.3-0.3-1.7c-3.4-2.7-5-5.2-6.5-7.9
                                        V3.3c-1.3-2.8-4.1-3.9-3.5,1.9C65.9,9.9,67.7,12.5,68.2,13.3z"/>
                                    <path class="st0" d="M15.9,65.1c0-0.1-0.2-0.2-0.3-0.2h-0.2c-0.1,0-0.2,0.1-0.3,0.2L10,76.3c-0.1,0.2,0.1,0.4,0.4,0.3h1.1
                                        c0.2,0,0.2-0.2,0.3-0.3c0.3-0.7,0.7-1.4,1-2.2h5.5l1,2.3c0,0.2,0.2,0.3,0.3,0.3h1.1c0.3,0,0.4-0.3,0.3-0.4L15.9,65.1z M13.4,72.8
                                        l2.1-4.6h0.1l2.1,4.6H13.4z"/>
                                    <path class="st0" d="M4.7,65.1H1c-0.2,0-0.3,0.2-0.3,0.3v11c0,0.2,0.2,0.3,0.3,0.3h1c0.2,0,0.3-0.2,0.3-0.3v-4h2.4
                                        c2,0,3.7-1.7,3.7-3.7C8.5,66.8,6.8,65.1,4.7,65.1z M4.7,70.9H2.3v-4.1h2.3c1.2,0,2.2,0.8,2.2,2C6.8,70,5.8,70.9,4.7,70.9z"/>
                                    <path class="st0" d="M112.2,68.6c0-2-1.7-3.6-3.7-3.6h-4.6c-0.2,0-0.3,0.2-0.3,0.3l-0.1,0v10.9c0,0.2,0.2,0.3,0.3,0.3h1.1
                                        c0.2,0,0.3-0.2,0.3-0.3v-4.2h2.5l2.2,4.4c0,0.1,0.2,0.2,0.3,0.2h1.3c0.3,0,0.4-0.3,0.3-0.4l-2.2-4.2
                                        C111.2,71.4,112.2,70.2,112.2,68.6z M108.3,70.8h-3v-4h3c1.1,0,2.1,0.9,2.1,2C110.3,69.9,109.3,70.8,108.3,70.8z"/>
                                    <path class="st0" d="M84.2,65.1h-6.6c-0.2,0-0.3,0.2-0.3,0.3l-0.1,0v11.1c0,0.2,0.2,0.3,0.3,0.3h1.1c0.2,0,0.3-0.2,0.3-0.3v-4.4
                                        h4.5c0.2,0,0.3-0.2,0.3-0.3v-0.9c0-0.2-0.2-0.3-0.3-0.3h-4.5v-3.9h5.3c0.2,0,0.3-0.2,0.3-0.3v-0.9C84.6,65.2,84.4,65.1,84.2,65.1z"
                                        />
                                    <path class="st0" d="M33,68.6c0-2-1.7-3.6-3.7-3.6h-4.6c-0.2,0-0.3,0.2-0.3,0.3l-0.1,0v10.9c0,0.2,0.2,0.3,0.3,0.3h1.1
                                        c0.2,0,0.3-0.2,0.3-0.3v-4.2h2.6l2.2,4.4c0,0.1,0.2,0.2,0.3,0.2h1.3c0.3,0,0.4-0.3,0.3-0.4L30.5,72C32,71.4,33,70.2,33,68.6z
                                         M29.1,70.8H26v-4h3.1c1.1,0,2.1,0.9,2.1,2C31.2,69.9,30.2,70.8,29.1,70.8z"/>
                                    <path class="st0" d="M93.5,65c-3.3,0-6,2.7-6,6s2.7,6,6,6s6-2.7,6-6C99.5,67.6,96.8,65,93.5,65z M93.5,75.3c-2.3,0-4.3-2-4.3-4.3
                                        c0-2.4,2-4.4,4.3-4.4c2.3,0,4.3,2.1,4.3,4.4C97.8,73.3,95.9,75.3,93.5,75.3z"/>
                                    <path class="st0" d="M144.8,66.6c0.2,0,0.3-0.2,0.3-0.3v-0.9c0-0.2-0.2-0.3-0.3-0.3h-6.7c-0.2,0-0.3,0.2-0.3,0.3h0v11
                                        c0,0.2,0.2,0.3,0.3,0.3h6.6c0.2,0,0.3-0.2,0.3-0.3v-0.9c0-0.2-0.2-0.3-0.3-0.3h-5.3v-3.6h4.5c0.2,0,0.3-0.2,0.3-0.3v-0.9
                                        c0-0.2-0.2-0.3-0.3-0.3h-4.5v-3.4H144.8z"/>
                                    <path class="st0" d="M57.4,65.1h-6.6c-0.2,0-0.3,0.2-0.3,0.3v11c0,0.2,0.2,0.3,0.3,0.3h6.6c0.2,0,0.3-0.2,0.3-0.3v-0.9
                                        c0-0.2-0.2-0.3-0.3-0.3h-5.3v-3.6h4.5c0.2,0,0.3-0.2,0.3-0.3v-0.9c0-0.2-0.2-0.3-0.3-0.3h-4.5v-3.4h5.3c0.2,0,0.3-0.2,0.3-0.3v-0.9
                                        C57.8,65.2,57.6,65.1,57.4,65.1z"/>
                                    <path class="st0" d="M68.2,75.2h-4.5v-9.8c0-0.2-0.2-0.3-0.3-0.3h-1.1c-0.2,0-0.3,0.2-0.3,0.3v11c0,0.2,0.2,0.3,0.3,0.3h5.9
                                        c0.2,0,0.3-0.2,0.3-0.3v-0.9C68.5,75.3,68.3,75.2,68.2,75.2z"/>
                                    <path class="st0" d="M42.3,66.6c1,0,2.1,0.3,2.9,1.1c0.2,0.2,0.3,0.2,0.4,0l0.7-0.7c0.2-0.1,0.2-0.3,0-0.4c-1.2-1-2.3-1.5-4-1.5
                                        c-3.3,0-6,2.7-6.1,5.9c0,3.3,2.7,6,6,6c1.4,0,2.9-0.6,4-1.6c0.1-0.1,0.1-0.3,0-0.4l-0.8-0.7c-0.1-0.1-0.2-0.1-0.3,0
                                        c-0.8,0.6-1.6,1.1-2.9,1.1c-2.4,0-4.2-2-4.2-4.3S39.9,66.6,42.3,66.6z"/>
                                    <path class="st0" d="M131.7,65.1c0-0.2-0.2-0.3-0.3-0.3h-0.3c-0.1,0-0.3,0.1-0.3,0.2l-3.5,8.5h-0.1l-3.5-8.5c0-0.1-0.2-0.2-0.3-0.2
                                        h-0.3c-0.1,0-0.3,0.2-0.3,0.3l-2.1,11.2c0,0.2,0.1,0.3,0.3,0.3h1.1c0.1,0,0.3-0.2,0.3-0.3l1.2-7.4h0.1l3.1,7.7
                                        c0,0.1,0.2,0.2,0.3,0.2h0.3c0.2,0,0.3-0.1,0.3-0.2l3.1-7.7h0.1l1.2,7.4c0.1,0.2,0.2,0.3,0.3,0.3h1.1c0.2,0,0.4-0.1,0.3-0.3
                                        L131.7,65.1z"/>
                                </g>
                                </svg>

                            </div>

                            <p><em>Checkout fast with Parcel for Me</em></p>
                            
                        </div>
                        
                        <button type="submit" on-tap="requestLogin" class="p4m-button white p4m-button-active p4m-register-button"><i class="p4micon-cart-empty"><!-- <span class="cart-items-number noitems">2</span> --></i>Use 1 Click Checkout</button>
                    </div>
                </div>
            </div>
        </template>
    </template>



    <script>
        // All this widget does is provide a btn that allows a consumer to register with P4M
        // clicking the btn will open a popup and load a local call to the server which checks
        // for things like is the user logged in and have they just purchased something.
        // If the user is logged in, the local call redirects to the retailer API which saves the consumer details
        // The user is ultimately redirected to the P4M ID server to complete the registration
        Polymer({
            is: "p4m-register",

            properties: {
                _topClass: {
                    type: String,
                    value: "active"
                },
                _loggedIn: {
                    type: Boolean
                },
                _notLoggedIn: {
                    type: Boolean
                }
            },

            ready: function ()
            {
                window.addEventListener('p4m-token-valid', this.load.bind(this));
                this.load();
            },

            load: function () {
                //Check to see if the user is logged in - if so just thank them for using P4M :)
                var token = this.$.p4mTokenCookie.readCookie();
                this.set('_loggedIn', token !== "");
                this.set('_notLoggedIn', !this._loggedIn);
            },

            requestLogin: function () {
                var event = new CustomEvent('p4m-request-login');
                window.dispatchEvent(event);
            },

            //onSignUp: function (e) {
            //    // we have a token from PP so now we can launch PP in a popup
            //    var signupUrl = "//" + window.location.host + "/p4m/signup";
            //    this.openPopup(signupUrl, "signupWindow", 650, 750);
            //},

            //openPopup: function (url, id, w, h) {
            //    // open the popup
            //    var left = (screen.width / 2) - (w / 2);
            //    var top = (screen.height / 2) - (h / 2);
            //    window.open(url, id, 'toolbar=no, location=no, directories=no, status=no, menubar=yes, copyhistory=no, width=' + w + ', height=' + h + ', top=' + top + ', left=' + left);
            //},
        });
    </script>
</dom-module>